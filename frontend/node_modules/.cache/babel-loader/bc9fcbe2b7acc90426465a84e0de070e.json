{"ast":null,"code":"import _toConsumableArray from\"/Users/Miardo/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/Miardo/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import PopupWithForm from'./PopupWithForm';import ImagePopup from'./ImagePopup';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/api';import*as auth from'../utils/auth';import{Route,Switch,Redirect,useHistory}from'react-router-dom';import Login from'./Login';import Register from'./Register';import InfoTooltip from'./InfoTooltip';import ProtectedRoute from'./ProtectedRoute';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setIsEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setIsAddPlacePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setIsEditAvatarPopupOpen=_useState6[1];var _useState7=useState({name:'',link:''}),_useState8=_slicedToArray(_useState7,2),selectedCard=_useState8[0],setSelectedCard=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),currentUser=_useState10[0],setCurrentUser=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),cards=_useState12[0],setCards=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isInfoTooltip=_useState14[0],setIsInfoTooltip=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),loggedIn=_useState16[0],setLoggedIn=_useState16[1];var _useState17=useState({email:''}),_useState18=_slicedToArray(_useState17,2),data=_useState18[0],setData=_useState18[1];var history=useHistory();var _useState19=useState({title:\"Что-то пошло не так! Попробуйте ещё раз.\",img:false}),_useState20=_slicedToArray(_useState19,2),isInfoTooltipStatus=_useState20[0],setIsInfoTooltipStatus=_useState20[1];useEffect(function(){api.getUserInfo().then(function(userInfo){setCurrentUser(userInfo);}).catch(function(err){return console.log(err);});api.getInitialCards().then(function(initialCards){setCards(initialCards);}).catch(function(err){return console.log(err);});},[]);var handleCardClick=function handleCardClick(card){setSelectedCard(card);};var handleEditProfileClick=function handleEditProfileClick(){setIsEditProfilePopupOpen(true);};var handleEditAvatarClick=function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);};var handleOpenInfoTooltip=function handleOpenInfoTooltip(){setIsInfoTooltip(true);};var closeAllPopups=function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsInfoTooltip(false);setSelectedCard({name:'',link:''});};var handleUpdateUser=function handleUpdateUser(data){api.editUserInfo(data).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.log(err);});};var handleUpdateAvatar=function handleUpdateAvatar(data){api.addAvatar(data).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.log(err);});};function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(data){api.addCard(data).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(err);});}function handleLogin(email,password){auth.authorize(email,password).then(function(res){if(res.token){localStorage.setItem('jwt',res.token);setData(email);setLoggedIn(true);history.push('/');}}).catch(function(err){return console.log(err);});};function handleRegister(email,password){auth.register(email,password).then(function(){handleOpenInfoTooltip();setIsInfoTooltipStatus({title:\"Вы успешно зарегистрировались!.\",img:true});history.push('/sign-in');}).catch(function(err){handleOpenInfoTooltip();console.log(err);});}function handleTokenCheck(){var jwt=localStorage.getItem('jwt');if(jwt){auth.getContent(jwt).then(function(res){setData({email:res.data.email});setLoggedIn(true);history.push(\"/\");}).catch(function(err){return console.log(err);});};};useEffect(function(){handleTokenCheck();},[]);function handleSignOut(){setLoggedIn(false);localStorage.removeItem('jwt');}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{onSignOut:handleSignOut,email:data.email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete,component:Main}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(InfoTooltip,{title:isInfoTooltipStatus.title,img:isInfoTooltipStatus.img,isOpen:isInfoTooltip,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditProfilePopup,{onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{onAddPlace:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{onUpdateAvatar:handleUpdateAvatar,isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"delete-card\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",decoration:\"popup__container-name_style-edition\",text:\"\\u0414\\u0430\"}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["/Users/Miardo/dev/react-mesto-auth/src/components/App.js"],"names":["React","useState","useEffect","Header","Main","Footer","PopupWithForm","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","api","auth","Route","Switch","Redirect","useHistory","Login","Register","InfoTooltip","ProtectedRoute","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","name","link","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isInfoTooltip","setIsInfoTooltip","loggedIn","setLoggedIn","email","data","setData","history","title","img","isInfoTooltipStatus","setIsInfoTooltipStatus","getUserInfo","then","userInfo","catch","err","console","log","getInitialCards","initialCards","handleCardClick","card","handleEditProfileClick","handleEditAvatarClick","handleAddPlaceClick","handleOpenInfoTooltip","closeAllPopups","handleUpdateUser","editUserInfo","res","handleUpdateAvatar","addAvatar","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","deleteCard","filter","handleAddPlaceSubmit","addCard","handleLogin","password","authorize","token","localStorage","setItem","push","handleRegister","register","handleTokenCheck","jwt","getItem","getContent","handleSignOut","removeItem"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport PopupWithForm from './PopupWithForm';\nimport ImagePopup from './ImagePopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport api from '../utils/api';\nimport * as auth from '../utils/auth';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport Login from './Login';\nimport Register from './Register';\nimport InfoTooltip from './InfoTooltip';\nimport ProtectedRoute from './ProtectedRoute';\n\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState({ name: '', link: '' });\n\n  const [currentUser, setCurrentUser] = useState({});\n  const [cards, setCards] = useState([]);\n\n  const [isInfoTooltip, setIsInfoTooltip] = useState(false);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [data, setData] = useState({ email: ''});\n  const history = useHistory();\n  const [isInfoTooltipStatus, setIsInfoTooltipStatus] = useState({\n    title: \"Что-то пошло не так! Попробуйте ещё раз.\",\n    img: false,\n  });\n\n  useEffect(() => {\n    api.getUserInfo()\n      .then((userInfo) => {\n        setCurrentUser(userInfo);\n      })\n      .catch((err) => console.log(err));\n\n    api.getInitialCards()\n      .then((initialCards) => {\n        setCards(initialCards)\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n\n  const handleCardClick = (card) => {\n    setSelectedCard(card)\n  }\n\n  const handleEditProfileClick = () => {\n    setIsEditProfilePopupOpen(true)\n  }\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarPopupOpen(true)\n  }\n\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true)\n  }\n\n  const handleOpenInfoTooltip = () => {\n    setIsInfoTooltip(true);\n  }\n\n\n  const closeAllPopups = () => {\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsInfoTooltip(false);\n    setSelectedCard({ name: '', link: '' });\n  }\n\n  const handleUpdateUser = (data) => {\n    api.editUserInfo(data)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  const handleUpdateAvatar = (data) => {\n    api.addAvatar(data)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    api.changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id)\n      .then(() => {\n        setCards((cards) => cards.filter((c) => c._id !== card._id));\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleAddPlaceSubmit(data) {\n    api.addCard(data)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleLogin(email, password) {\n    auth.authorize(email, password)\n      .then((res) => {\n        if (res.token) {\n          localStorage.setItem('jwt', res.token);\n          setData(email);\n          setLoggedIn(true);\n          history.push('/');\n        }\n      })\n      .catch((err) => console.log(err));\n  };\n\n  function handleRegister(email, password) {\n    auth.register(email, password)\n      .then(() => {\n        handleOpenInfoTooltip()\n        setIsInfoTooltipStatus({ title: \"Вы успешно зарегистрировались!.\", img: true })\n        history.push('/sign-in')\n      })\n      .catch((err) => {\n        handleOpenInfoTooltip()\n        console.log(err);\n      })\n  }\n\n  function handleTokenCheck() {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth.getContent(jwt)\n        .then((res) => {\n          setData({ email: res.data.email})\n          setLoggedIn(true)\n          history.push(\"/\");\n        })\n        .catch(err => console.log(err));\n    };\n  };\n\n  useEffect(() => {\n    handleTokenCheck();\n  }, []);\n\n  function handleSignOut() {\n    setLoggedIn(false);\n    localStorage.removeItem('jwt');\n  }\n\n\n  return (\n    <>\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header onSignOut={handleSignOut} email={data.email} />\n        <Switch>\n          <ProtectedRoute exact path=\"/\" loggedIn={loggedIn} onEditProfile={handleEditProfileClick} onAddPlace={handleAddPlaceClick} onEditAvatar={handleEditAvatarClick} onCardClick={handleCardClick} cards={cards} onCardLike={handleCardLike} onCardDelete={handleCardDelete} component={Main} />\n          <Route path=\"/sign-in\">\n            <Login onLogin={handleLogin} />\n          </Route>\n          <Route path=\"/sign-up\">\n            <Register onRegister={handleRegister} />\n          </Route>\n          <Route>\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}\n          </Route>\n        </Switch>\n        <Footer />\n        <InfoTooltip title={isInfoTooltipStatus.title} img={isInfoTooltipStatus.img} isOpen={isInfoTooltip} onClose={closeAllPopups} />\n        <EditProfilePopup onUpdateUser={handleUpdateUser} isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} />\n        <AddPlacePopup onAddPlace={handleAddPlaceSubmit} isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} />\n        <EditAvatarPopup onUpdateAvatar={handleUpdateAvatar} isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} />\n        <PopupWithForm name=\"delete-card\" title=\"Вы уверены?\" decoration=\"popup__container-name_style-edition\" text=\"Да\" />\n        <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n      </CurrentUserContext.Provider>\n    </>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}